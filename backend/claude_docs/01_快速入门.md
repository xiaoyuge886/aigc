# 快速开始

使用 Python 或 TypeScript Agent SDK 开始构建能够自主工作的 AI 代理

使用 Agent SDK 构建一个 AI 代理，它可以读取你的代码、发现错误并修复它们，所有这一切都无需手动干预。

**你将要做的事情：**

1. 使用 Agent SDK 设置一个项目
2. 创建一个包含一些有缺陷代码的文件
3. 运行一个代理，自动查找并修复错误

## 前置条件

- **Node.js 18+** 或 **Python 3.10+**
- 一个 **Anthropic 账户**（在此注册）

## 设置

### 1. 安装 Claude Code

Agent SDK 使用 Claude Code 作为其运行时。为你的平台安装它：

**macOS/Linux/WSL**
```bash
npm install -g @anthropic-ai/claude-code
```

**Homebrew**
```bash
brew install claude-ai/tap/claude-code
```

在你的机器上安装 Claude Code 后，在终端中运行 `claude` 并按照提示进行身份验证。SDK 将自动使用此身份验证。

### 2. 创建项目文件夹

为此快速开始创建一个新目录：

```bash
mkdir my-agent && cd my-agent
```

### 3. 安装 SDK

为你的语言安装 Agent SDK 包：

**TypeScript**
```bash
npm install @anthropic-ai/claude-agent-sdk
```

**Python (uv)**
```bash
uv add claude-agent-sdk
```

**Python (pip)**
```bash
pip install claude-agent-sdk
```

### 4. 设置你的 API 密钥

如果你已经对 Claude Code 进行了身份验证（通过在终端中运行 `claude`），SDK 将自动使用该身份验证。

否则，你需要一个 API 密钥，你可以从 Claude 控制台 获取。

在你的项目目录中创建一个 `.env` 文件并在其中存储 API 密钥：

```bash
ANTHROPIC_API_KEY=your-api-key
```

## 创建一个有缺陷的文件

此快速开始将引导你构建一个可以查找和修复代码中错误的代理。首先，你需要一个包含一些有意错误的文件供代理修复。在 `my-agent` 目录中创建 `utils.py` 并粘贴以下代码：

```python
def calculate_average(numbers):
    total = 0
    for num in numbers:
        total += num
    return total / len(numbers)

def get_user_name(user):
    return user["name"].upper()
```

此代码有两个错误：

1. `calculate_average([])` 会因除以零而崩溃
2. `get_user_name(None)` 会因 TypeError 而崩溃

## 构建一个查找和修复错误的代理

如果你使用 Python SDK，请创建 `agent.py`，如果使用 TypeScript，请创建 `agent.ts`：

**Python**
```python
import asyncio
from claude_agent_sdk import query, ClaudeAgentOptions, AssistantMessage, ResultMessage

async def main():
    # Agentic loop: streams messages as Claude works
    async for message in query(
        prompt="Review utils.py for bugs that would cause crashes. Fix any issues you find.",
        options=ClaudeAgentOptions(
            allowed_tools=["Read", "Edit", "Glob"],  # Tools Claude can use
            permission_mode="acceptEdits"            # Auto-approve file edits
        )
    ):
        # Print human-readable output
        if isinstance(message, AssistantMessage):
            for block in message.content:
                if hasattr(block, "text"):
                    print(block.text)              # Claude's reasoning
                elif hasattr(block, "name"):
                    print(f"Tool: {block.name}")   # Tool being called
        elif isinstance(message, ResultMessage):
            print(f"Done: {message.subtype}")      # Final result

asyncio.run(main())
```

**TypeScript**
```typescript
import { query } from '@anthropic-ai/claude-agent-sdk';

async function main() {
  for await (const message of query({
    prompt: 'Review utils.py for bugs that would cause crashes. Fix any issues you find.',
    options: {
      allowedTools: ['Read', 'Edit', 'Glob'],
      permissionMode: 'acceptEdits'
    }
  })) {
    if (message.type === 'assistant') {
      for (const block of message.content) {
        if ('text' in block) {
          console.log(block.text);
        } else if ('name' in block) {
          console.log(`Tool: ${block.name}`);
        }
      }
    } else if (message.type === 'result') {
      console.log(`Done: ${message.subtype}`);
    }
  }
}

main();
```

### 运行你的代理

**Python**
```bash
python agent.py
```

**TypeScript**
```bash
npx tsx agent.ts
```

运行后，检查 `utils.py`。你会看到处理空列表和空用户的防御性代码。你的代理自主地：

1. **读取** `utils.py` 以理解代码
2. **分析** 逻辑并识别会导致崩溃的边界情况
3. **编辑** 文件以添加适当的错误处理

## 尝试其他提示

现在你的代理已设置好，尝试一些不同的提示：

- `"Add docstrings to all functions in utils.py"`
- `"Add type hints to all functions in utils.py"`
- `"Create a README.md documenting the functions in utils.py"`

## 自定义你的代理

你可以通过更改选项来修改代理的行为。

### 添加网络搜索功能

**Python**
```python
options=ClaudeAgentOptions(
    allowed_tools=["Read", "Edit", "Glob", "WebSearch"],
    permission_mode="acceptEdits"
)
```

### 给 Claude 一个自定义系统提示

**Python**
```python
options=ClaudeAgentOptions(
    allowed_tools=["Read", "Edit", "Glob"],
    permission_mode="acceptEdits",
    system_prompt="You are a senior Python developer. Always follow PEP 8 style guidelines."
)
```

### 在终端中运行命令

**Python**
```python
options=ClaudeAgentOptions(
    allowed_tools=["Read", "Edit", "Glob", "Bash"],
    permission_mode="acceptEdits"
)
```

启用 `Bash` 后，尝试：`"Write unit tests for utils.py, run them, and fix any failures"`

## 关键概念

### 工具

工具控制你的代理可以做什么：

| 工具 | 代理可以做的事情 |
| --- | --- |
| `Read`、`Glob`、`Grep` | 只读分析 |
| `Read`、`Edit`、`Glob` | 分析和修改代码 |
| `Read`、`Edit`、`Bash`、`Glob`、`Grep` | 完全自动化 |

### 权限模式

权限模式控制你想要多少人工监督：

| 模式 | 行为 | 用例 |
| --- | --- | --- |
| `acceptEdits` | 自动批准文件编辑，询问其他操作 | 受信任的开发工作流 |
| `bypassPermissions` | 无提示运行 | CI/CD 管道、自动化 |
| `default` | 需要 `canUseTool` 回调来处理批准 | 自定义批准流程 |

## 后续步骤

现在你已经创建了你的第一个代理，学习如何扩展其功能并将其定制为你的用例：

- **权限**：控制你的代理可以做什么以及何时需要批准
- **钩子**：在工具调用之前或之后运行自定义代码
- **会话**：构建维护上下文的多轮代理
- **MCP 服务器**：连接到数据库、浏览器、API 和其他外部系统
- **托管**：将代理部署到 Docker、云和 CI/CD
- **示例代理**：查看完整示例：电子邮件助手、研究代理等
