# å¤„ç†æƒé™

åœ¨ Claude Agent SDK ä¸­æ§åˆ¶å·¥å…·ä½¿ç”¨å’Œæƒé™

SDK æƒé™

Claude Agent SDK æä¾›å¼ºå¤§çš„æƒé™æ§åˆ¶ï¼Œå…è®¸æ‚¨ç®¡ç† Claude åœ¨åº”ç”¨ç¨‹åºä¸­å¦‚ä½•ä½¿ç”¨å·¥å…·ã€‚

æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•ä½¿ç”¨ `canUseTool` å›è°ƒã€é’©å­å’Œ settings.json æƒé™è§„åˆ™æ¥å®ç°æƒé™ç³»ç»Ÿã€‚

## æ¦‚è¿°

Claude Agent SDK æä¾›å››ç§äº’è¡¥çš„æ–¹å¼æ¥æ§åˆ¶å·¥å…·ä½¿ç”¨ï¼š

1. **æƒé™æ¨¡å¼** - å½±å“æ‰€æœ‰å·¥å…·çš„å…¨å±€æƒé™è¡Œä¸ºè®¾ç½®
2. **canUseTool å›è°ƒ** - ç”¨äºå…¶ä»–è§„åˆ™æœªæ¶µç›–çš„æƒ…å†µçš„è¿è¡Œæ—¶æƒé™å¤„ç†ç¨‹åº
3. **é’©å­** - é€šè¿‡è‡ªå®šä¹‰é€»è¾‘å¯¹æ¯ä¸ªå·¥å…·æ‰§è¡Œè¿›è¡Œç»†ç²’åº¦æ§åˆ¶
4. **æƒé™è§„åˆ™ (settings.json)** - å…·æœ‰é›†æˆ bash å‘½ä»¤è§£æçš„å£°æ˜å¼å…è®¸/æ‹’ç»è§„åˆ™

## æƒé™æ¨¡å¼

æƒé™æ¨¡å¼æä¾›å¯¹ Claude å¦‚ä½•ä½¿ç”¨å·¥å…·çš„å…¨å±€æ§åˆ¶ã€‚

### å¯ç”¨æ¨¡å¼

SDK æ”¯æŒå››ç§æƒé™æ¨¡å¼ï¼š

| æ¨¡å¼ | æè¿° | å·¥å…·è¡Œä¸º |
| --- | --- | --- |
| `default` | æ ‡å‡†æƒé™è¡Œä¸º | åº”ç”¨æ­£å¸¸æƒé™æ£€æŸ¥ |
| `plan` | è§„åˆ’æ¨¡å¼ - æ— æ‰§è¡Œ | Claude åªèƒ½ä½¿ç”¨åªè¯»å·¥å…·ï¼›åœ¨æ‰§è¡Œå‰å‘ˆç°è®¡åˆ’ |
| `acceptEdits` | è‡ªåŠ¨æ¥å—æ–‡ä»¶ç¼–è¾‘ | æ–‡ä»¶ç¼–è¾‘å’Œæ–‡ä»¶ç³»ç»Ÿæ“ä½œè‡ªåŠ¨æ‰¹å‡† |
| `bypassPermissions` | ç»•è¿‡æ‰€æœ‰æƒé™æ£€æŸ¥ | æ‰€æœ‰å·¥å…·æ— éœ€æƒé™æç¤ºå³å¯è¿è¡Œï¼ˆè°¨æ…ä½¿ç”¨ï¼‰ |

### è®¾ç½®æƒé™æ¨¡å¼

#### 1. åˆå§‹é…ç½®

```typescript
import { query } from "@anthropic-ai/laude-agent-sdk";

const result = await query({
  prompt: "Help me refactor this code",
  options: {
    permissionMode: 'default'  // æ ‡å‡†æƒé™æ¨¡å¼
  }
});
```

#### 2. åŠ¨æ€æ¨¡å¼æ›´æ”¹ï¼ˆä»…é™æµå¼ï¼‰

```typescript
import { query } from "@anthropic-æ™ºèƒ½/claude-agent-sdk";

async function* streamInput() {
  yield {
    type: 'user',
    message: {
      role: 'user',
      content: "Let's start with default permissions"
    }
  };

  // ç¨ååœ¨å¯¹è¯ä¸­...
  yield {
    type: 'user',
    message: {
      role: 'user',
      content: "Now let's speed up development"
    }
  };
}

const q = query({
  prompt: streamInput(),
  options: {
    permissionMode: 'default'  // ä»¥é»˜è®¤æ¨¡å¼å¯åŠ¨
  }
});

// åŠ¨æ€æ›´æ”¹æ¨¡å¼
await q.setPermissionMode('acceptEdits');
```

### æ¨¡å¼ç‰¹å®šè¡Œä¸º

#### æ¥å—ç¼–è¾‘æ¨¡å¼ (`acceptEdits`)

- æ‰€æœ‰æ–‡ä»¶ç¼–è¾‘è‡ªåŠ¨æ‰¹å‡†
- æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼ˆmkdirã€touchã€rmã€mvã€cpï¼‰è‡ªåŠ¨æ‰¹å‡†
- å…¶ä»–å·¥å…·ä»éœ€è¦æ­£å¸¸æƒé™
- é€‚ç”¨äºå¿«é€ŸåŸå‹è®¾è®¡å’Œè¿­ä»£

#### ç»•è¿‡æƒé™æ¨¡å¼ (`bypassPermissions`)

- **æ‰€æœ‰å·¥å…·ä½¿ç”¨è‡ªåŠ¨æ‰¹å‡†**
- ä¸å‡ºç°æƒé™æç¤º
- é’©å­ä»ç„¶æ‰§è¡Œï¼ˆä»ç„¶å¯ä»¥é˜»æ­¢æ“ä½œï¼‰
- **è°¨æ…ä½¿ç”¨** - Claude å…·æœ‰å®Œæ•´çš„ç³»ç»Ÿè®¿é—®æƒé™

### æƒé™æµç¨‹

æƒé™æµç¨‹ä¸­çš„æ¨¡å¼ä¼˜å…ˆçº§ï¼š

1. **é’©å­é¦–å…ˆæ‰§è¡Œ** - å¯ä»¥å…è®¸ã€æ‹’ç»ã€è¯¢é—®æˆ–ç»§ç»­
2. **æ£€æŸ¥æ‹’ç»è§„åˆ™** - æ— è®ºæ¨¡å¼å¦‚ä½•éƒ½é˜»æ­¢å·¥å…·
3. **æ£€æŸ¥å…è®¸è§„åˆ™** - å¦‚æœåŒ¹é…åˆ™å…è®¸å·¥å…·
4. **æ£€æŸ¥è¯¢é—®è§„åˆ™** - å¦‚æœåŒ¹é…åˆ™æç¤ºè·å¾—æƒé™
5. **è¯„ä¼°æƒé™æ¨¡å¼**ï¼š
   - **`bypassPermissions` æ¨¡å¼** - å¦‚æœæ´»è·ƒï¼Œå…è®¸æ‰€æœ‰å‰©ä½™å·¥å…·
   - **å…¶ä»–æ¨¡å¼** - å»¶è¿Ÿåˆ° `canUseTool` å›è°ƒ
6. **`canUseTool` å›è°ƒ** - å¤„ç†å‰©ä½™æƒ…å†µ

## canUseTool

`canUseTool` å›è°ƒåœ¨è°ƒç”¨ `query` å‡½æ•°æ—¶ä½œä¸ºé€‰é¡¹ä¼ é€’ã€‚å®ƒæ¥æ”¶å·¥å…·åç§°å’Œè¾“å…¥å‚æ•°ï¼Œå¿…é¡»è¿”å›ä¸€ä¸ªå†³å®š - å…è®¸æˆ–æ‹’ç»ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•å®ç°äº¤äº’å¼å·¥å…·æ‰¹å‡†ï¼š

```typescript
import { query } from "@anthropic-ai/claude-agent-sdk";

async function promptForToolApproval(toolName: string, input: any) {
  console.log("\nğŸ”§ Tool Request:");
  console.log(`   Tool: ${toolName}`);

  // æ˜¾ç¤ºå·¥å…·å‚æ•°
  if (input && Object.keys(input).length > 0) {
    console.log("   Parameters:");
    for (const [key, value] of Object.entries(input)) {
      let displayValue = value;
      if (typeof value === 'string' && value.length > 100) {
        displayValue = value.substring(0, 100) + "...";
      } else if (typeof value === 'object') {
        displayValue = JSON.stringify(value, null, 2);
      }
      console.log(`     ${key}: ${displayValue}`);
    }
  }

  // è·å–ç”¨æˆ·æ‰¹å‡†
  const approved = await getUserApproval();

  if (approved) {
    console.log("   âœ… Approved\n");
    return {
      behavior: "allow",
      updatedInput: input
    };
  } else {
    console.log("   âŒ Denied\n");
    return {
      behavior: "deny",
      message: "User denied permission for this tool"
    };
  }
}

// ä½¿ç”¨æƒé™å›è°ƒ
const result = await query({
  prompt: "Help me analyze this codebase",
  options: {
    canUseTool: async (toolName, input) => {
      return promptForToolApproval(toolName, input);
    }
  }
});
```

## å¤„ç† AskUserQuestion å·¥å…·

`AskUserQuestion` å·¥å…·å…è®¸ Claude åœ¨å¯¹è¯æœŸé—´å‘ç”¨æˆ·æå‡ºæ¾„æ¸…é—®é¢˜ã€‚

### è¾“å…¥ç»“æ„

å½“ä½¿ç”¨ `toolName: "AskUserQuestion"` è°ƒç”¨ `canUseTool` æ—¶ï¼Œè¾“å…¥åŒ…å«ï¼š

```json
{
  "questions": [
    {
      "question": "Which database should we use?",
      "header": "Database",
      "options": [
        { "label": "PostgreSQL", "description": "Relational, ACID compliant" },
        { "label": "MongoDB", "description": "Document-based, flexible schema" }
      ],
      "multiSelect": false
    }
  ]
}
```

### è¿”å›ç­”æ¡ˆ

åœ¨ `updatedInput.answers` ä¸­è¿”å›ç­”æ¡ˆï¼š

```typescript
return {
  behavior: "allow",
  updatedInput: {
    questions: input.questions,
    answers: {
      "Which database should we use?": "PostgreSQL",
      "Which features should we enable?": "Authentication, Caching"
    }
  }
}
```

å¤šé€‰ç­”æ¡ˆæ˜¯é€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚ï¼Œ`"Authentication, Caching"`ï¼‰ã€‚

## ç›¸å…³èµ„æº

- é’©å­æŒ‡å— - äº†è§£å¦‚ä½•å®ç°é’©å­ä»¥å¯¹å·¥å…·æ‰§è¡Œè¿›è¡Œç»†ç²’åº¦æ§åˆ¶
- è®¾ç½®ï¼šæƒé™è§„åˆ™ - ä½¿ç”¨ bash å‘½ä»¤è§£æé…ç½®å£°æ˜å¼å…è®¸/æ‹’ç»è§„åˆ™
- TypeScript SDK å‚è€ƒ - å®Œæ•´çš„APIæ–‡æ¡£
- Python SDK å‚è€ƒ - Python APIæ–‡æ¡£
