# 修改系统提示词

学习如何通过三种方法修改系统提示词来自定义Claude的行为

系统提示词定义了Claude的行为、能力和响应风格。

## 修改方法

### 方法1：CLAUDE.md文件（项目级指令）

CLAUDE.md文件提供项目特定的上下文和指令。

**位置和发现：**
- 项目级：工作目录中的`CLAUDE.md`或`.claude/CLAUDE.md`
- 用户级：`~/.claude/CLAUDE.md`用于全局指令

**重要：** SDK只有在您明确配置`settingSources`（TypeScript）或`setting_sources`（Python）时才会读取CLAUDE.md文件。

**内容格式：**
```markdown
# 项目指南

## 代码风格

- 使用TypeScript严格模式
- 在React中优先使用函数组件
- 始终为公共API包含JSDoc注释

## 测试

- 提交前运行`npm test`
- 保持>80%的代码覆盖率
- 使用jest进行单元测试，playwright进行E2E测试
```

### 方法2：输出样式（持久配置）

输出样式是修改Claude系统提示词的保存配置。

### 方法3：使用带append的`systemPrompt`

使用Claude Code预设和`append`属性来添加您的自定义指令。

```typescript
import { query } from "@anthropic-ai/claude-agent-sdk";

const messages = [];

for await (const message of query({
  prompt: "帮我写一个计算斐波那契数列的Python函数",
  options: {
    systemPrompt: {
      type: "preset",
      preset: "claude_code",
      append: "在Python代码中始终包含详细的文档字符串和类型提示。"
    },
  },
})) {
  messages.push(message);
}
```

### 方法4：自定义系统提示词

您可以提供自定义字符串作为`systemPrompt`，用您自己的指令完全替换默认设置。

```typescript
import { query } from "@anthropic-ai/claude-agent-sdk";

const customPrompt = `您是一位Python编码专家。

遵循以下指南：
- 编写干净、文档完善的代码
- 为所有函数使用类型提示
- 包含全面的文档字符串
- 在适当时优先使用函数式编程模式
- 始终解释您的代码选择`;

const messages = [];

for await (const message of query({
  prompt: "创建一个数据处理管道",
  options: {
    systemPrompt: customPrompt,
  },
})) {
  messages.push(message);
}
```

## 所有四种方法的比较

| 功能 | CLAUDE.md | 输出样式 | 带append的`systemPrompt` | 自定义`systemPrompt` |
| --- | --- | --- | --- | --- |
| **持久性** | 每个项目文件 | 保存为文件 | 仅会话 | 仅会话 |
| **可重用性** | 跨项目 | 跨项目 | 代码重复 | 代码重复 |
| **管理** | 在文件系统上 | CLI + 文件 | 在代码中 | 在代码中 |
| **默认工具** | 保留 | 保留 | 保留 | 丢失（除非包含） |
| **内置安全性** | 维护 | 维护 | 维护 | 必须添加 |
| **环境上下文** | 自动 | 自动 | 自动 | 必须提供 |
| **自定义级别** | 仅添加 | 替换默认 | 仅添加 | 完全控制 |
| **版本控制** | 与项目一起 | 是 | 与代码一起 | 与代码一起 |
| **范围** | 项目特定 | 用户或项目 | 代码会话 | 代码会话 |

## 用例和最佳实践

### 何时使用CLAUDE.md

- 项目特定的编码标准和约定
- 记录项目结构和架构
- 列出常用命令（构建、测试、部署）
- 适用于项目中所有SDK使用的指令

### 何时使用输出样式

- 跨会话的持久行为更改
- 团队共享配置
- 专门的助手（代码审查员、数据科学家、DevOps）
- 需要版本控制的复杂提示词修改

### 何时使用带append的`systemPrompt`

- 添加特定的编码标准或偏好
- 自定义输出格式
- 添加领域特定知识
- 修改响应详细程度

### 何时使用自定义`systemPrompt`

- 完全控制Claude的行为
- 专门的单会话任务
- 测试新的提示词策略
- 不需要默认工具的情况
- 构建具有独特行为的专门代理

## 另请参阅

- 输出样式 - 完整的输出样式文档
- TypeScript SDK指南 - 完整的SDK使用指南
- TypeScript SDK参考 - 完整的API文档
- 配置指南 - 通用配置选项
