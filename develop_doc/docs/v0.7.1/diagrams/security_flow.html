<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®å®‰å…¨ä¸æƒé™æ§åˆ¶æµç¨‹å›¾</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .diagram-container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #F44336;
            padding-bottom: 10px;
        }
        .description {
            color: #666;
            line-height: 1.6;
            margin: 20px 0;
        }
        .security-notes {
            background: #ffebee;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            border-left: 4px solid #F44336;
        }
    </style>
</head>
<body>
    <h1>æ•°æ®å®‰å…¨ä¸æƒé™æ§åˆ¶æµç¨‹å›¾</h1>
    <div class="description">
        <p>å±•ç¤ºä»è®¤è¯åˆ°å®¡è®¡çš„å®Œæ•´å®‰å…¨é“¾è·¯ï¼Œç¡®ä¿ä¼ä¸šçº§æ•°æ®å®‰å…¨ä¸åˆè§„æ€§ã€‚</p>
    </div>

    <div class="diagram-container">
        <div class="mermaid">
flowchart TD
    Start([ç”¨æˆ·è®¿é—®]) --> Auth{è®¤è¯æ–¹å¼}

    Auth -->|ç”¨æˆ·åå¯†ç | A1[æœ¬åœ°è®¤è¯]
    Auth -->|SSO| A2[OAuth2/LDAP/SAML]

    A1 --> Token[é¢å‘JWT Token]
    A2 --> Token

    Token --> Verify{éªŒè¯Token}

    Verify -->|æ— æ•ˆ| Reject[æ‹’ç»è®¿é—®]
    Verify -->|æœ‰æ•ˆ| Extract[æå–ä¿¡æ¯<br/>ç§Ÿæˆ·ID/ç”¨æˆ·ID/è§’è‰²]

    Extract --> APIGateway[API Gateway<br/>é‰´æƒ+é™æµ]

    APIGateway --> Business{ä¸šåŠ¡é‰´æƒ}

    Business -->|æ— æƒé™| Reject
    Business -->|æœ‰æƒé™| DataLayer[æ•°æ®å±‚è®¿é—®]

    DataLayer --> Isolation{æ•°æ®éš”ç¦»}

    Isolation -->|ç§Ÿæˆ·çº§| I1[Schemaéš”ç¦»]
    Isolation -->|åœºæ™¯çº§| I2[Row-level Security]

    I1 --> Access[è®¿é—®æ•°æ®]
    I2 --> Access

    Access --> Sensitive{æ•æ„Ÿæ•°æ®?}

    Sensitive -->|æ˜¯| Mask[æ•°æ®è„±æ•]
    Sensitive -->|å¦| Return[è¿”å›ç»“æœ]

    Mask --> Return

    Return --> Audit[å®¡è®¡æ—¥å¿—]

    Audit --> End([å®Œæˆ])

    style Auth fill:#ffebee
    style Verify fill:#fff3e0
    style Business fill:#e8f5e9
    style Isolation fill:#e3f2fd
    style Sensitive fill:#fce4ec
    style Audit fill:#f3e5f5
        </div>
    </div>

    <div class="security-notes">
        <h3>ğŸ”’ ä¼ä¸šçº§å®‰å…¨ç‰¹æ€§</h3>
        <ul>
            <li><strong>è®¤è¯</strong>ï¼šæ”¯æŒç”¨æˆ·åå¯†ç ã€OAuth2ã€LDAPã€SAMLå¤šç§æ–¹å¼</li>
            <li><strong>Tokenç®¡ç†</strong>ï¼šJWT Token + Refresh Tokenæœºåˆ¶ï¼Œæ”¯æŒæ— æ„Ÿåˆ·æ–°</li>
            <li><strong>é‰´æƒ</strong>ï¼šAPI Gatewayç»Ÿä¸€é‰´æƒ + ä¸šåŠ¡å±‚ç»†ç²’åº¦æƒé™æ§åˆ¶</li>
            <li><strong>æ•°æ®éš”ç¦»</strong>ï¼šç§Ÿæˆ·çº§Schemaéš”ç¦» + åœºæ™¯çº§Row-level Security</li>
            <li><strong>æ•æ„Ÿæ•°æ®ä¿æŠ¤</strong>ï¼šæ—¥å¿—è„±æ•ã€ä¼ è¾“åŠ å¯†ã€å­˜å‚¨åŠ å¯†</li>
            <li><strong>å®¡è®¡åˆè§„</strong>ï¼šå…¨é“¾è·¯å®¡è®¡æ—¥å¿—ï¼Œä¿ç•™è‡³å°‘6ä¸ªæœˆï¼ˆå¯é…ç½®ï¼‰</li>
        </ul>
    </div>
</body>
</html>
